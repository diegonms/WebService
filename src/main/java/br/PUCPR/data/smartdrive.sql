-- ===============================================
-- BANCO DE DADOS: aluguel_carros
-- SISTEMA DE GERENCIAMENTO DE ALUGUEL DE CARROS
-- ===============================================

CREATE DATABASE aluguel_carros;
USE aluguel_carros;

-- ===============================================
-- TABELA: CLIENTE
-- ===============================================
CREATE TABLE CLIENTE (
    ID_CLIENTE INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    CPF CHAR(11) UNIQUE NOT NULL,
    TELEFONE VARCHAR(15),
    EMAIL VARCHAR(100) UNIQUE,
    ENDERECO VARCHAR(150),
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ===============================================
-- TABELA: CARRO
-- ===============================================
CREATE TABLE CARRO (
    ID_CARRO INT PRIMARY KEY AUTO_INCREMENT,
    MODELO VARCHAR(100) NOT NULL,
    MARCA VARCHAR(50) NOT NULL,
    ANO INT,
    PLACA CHAR(7) UNIQUE NOT NULL,
    STATUS ENUM('DISPONIVEL','ALUGADO','MANUTENCAO') DEFAULT 'DISPONIVEL',
    VALOR_DIARIA DECIMAL(10,2) NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ===============================================
-- TABELA: FUNCIONARIO
-- ===============================================
CREATE TABLE FUNCIONARIO (
    ID_FUNCIONARIO INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) UNIQUE NOT NULL,
    SENHA VARCHAR(255) NOT NULL,
    CARGO ENUM('ADMIN','USER') DEFAULT 'USER',
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ===============================================
-- TABELA: ALUGUEL
-- ===============================================
CREATE TABLE ALUGUEL (
    ID_ALUGUEL INT PRIMARY KEY AUTO_INCREMENT,
    FK_CLIENTE_ID INT NOT NULL,
    FK_CARRO_ID INT NOT NULL,
    FK_FUNCIONARIO_ID INT NOT NULL,
    DATA_INICIO DATE NOT NULL,
    DATA_FIM DATE NOT NULL,
    VALOR_TOTAL DECIMAL(10,2),
    STATUS ENUM('ATIVO','FINALIZADO','CANCELADO') DEFAULT 'ATIVO',
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_ALUGUEL_CLIENTE FOREIGN KEY (FK_CLIENTE_ID) REFERENCES CLIENTE(ID_CLIENTE),
    CONSTRAINT FK_ALUGUEL_CARRO FOREIGN KEY (FK_CARRO_ID) REFERENCES CARRO(ID_CARRO),
    CONSTRAINT FK_ALUGUEL_FUNC FOREIGN KEY (FK_FUNCIONARIO_ID) REFERENCES FUNCIONARIO(ID_FUNCIONARIO)
);

-- ===============================================
-- TABELA: PAGAMENTO
-- ===============================================
CREATE TABLE PAGAMENTO (
    ID_PAGAMENTO INT PRIMARY KEY AUTO_INCREMENT,
    FK_ALUGUEL_ID INT NOT NULL,
    DATA_PAGAMENTO DATE NOT NULL,
    VALOR_PAGO DECIMAL(10,2) NOT NULL,
    METODO ENUM('CARTAO','PIX','DINHEIRO') NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_PAGAMENTO_ALUGUEL FOREIGN KEY (FK_ALUGUEL_ID) REFERENCES ALUGUEL(ID_ALUGUEL)
);

-- ===============================================
-- TABELA: MANUTENCAO
-- ===============================================
CREATE TABLE MANUTENCAO (
    ID_MANUTENCAO INT PRIMARY KEY AUTO_INCREMENT,
    FK_CARRO_ID INT NOT NULL,
    DATA_MANUTENCAO DATE NOT NULL,
    DESCRICAO VARCHAR(255) NOT NULL,
    VALOR DECIMAL(10,2),
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_MANUTENCAO_CARRO FOREIGN KEY (FK_CARRO_ID) REFERENCES CARRO(ID_CARRO)
);

-- ===============================================
-- (Opcional) TABELA DE LOG DE ERROS
-- ===============================================
CREATE TABLE LOG_ERROS (
    ID_ERRO INT PRIMARY KEY AUTO_INCREMENT,
    DATA_ERRO DATETIME DEFAULT CURRENT_TIMESTAMP,
    ENDPOINT VARCHAR(100),
    MENSAGEM VARCHAR(255),
    CODIGO_ERRO INT
);

SELECT
  A.ID_ALUGUEL,
  C.NOME AS NOME_CLIENTE,
  CAR.MODELO AS MODELO_CARRO,
  F.NOME AS NOME_FUNCIONARIO,
  A.DATA_INICIO,
  A.DATA_FIM,
  A.VALOR_TOTAL,
  A.STATUS
FROM
  ALUGUEL A
JOIN CLIENTE C ON A.FK_CLIENTE_ID = C.ID_CLIENTE
JOIN CARRO CAR ON A.FK_CARRO_ID = CAR.ID_CARRO
JOIN FUNCIONARIO F ON A.FK_FUNCIONARIO_ID = F.ID_FUNCIONARIO;

